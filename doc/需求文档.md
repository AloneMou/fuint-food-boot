# 安克咖啡OpenApi开发需求


# 技术与集成要求

## API基础能力

1. 设计RESTful API接口架构
2. 配置HTTPS/TLS 1.2+安全协议
3. 编写完整接口文档

## 身份认证与安全

1. 集成OAuth2/JWT Token/API Key认证机制
2. 实现接口限流功能
3. 配置IP白名单策略

## 回调能力/事件通知

1. 设计事件推送机制
2. 开发下单事件回调接口
3. 开发订单制作完成事件回调
4. 开发优惠券核销事件回调

# 需要开发的模块

## 用户
- 同步用户
支持单个和批量的员工数据同步
(无此员工,默认创建,有此员工,则更新)
以手机号码为唯一键

- 获取用户信息
获取用户详情

- 获取用户优惠券列表
支持分页查询
支持优惠券状态条件筛选(等于)

## 订单
- 创建订单

    支持多商品.多商品数量,
    自动计算当前订单最优惠价格

    补充: 入参增加一个'预创建订单的总订单价格',需校验此价格是否与创建订单计算价格一致,如不一致则需返回异常: 商品更新,请重新下单

- 预创建订单

    实时算价:根据匹配的营销活动(优惠规则)与当前用户的优惠券 计算
    (入参若未传用户优惠券自动匹配改用户最优惠的券)

    接口入参与创建订单一致
    接口出参需加上:此订单用户适用优惠券列表

- 取消订单
    
    取消订单若订单已支付,自动退款

- 支付订单

    支付成功,并发送订单支付成功事件回调

- 订单退款

    触发退款逻辑,退款成功修改订单支付状态为已退款,并发送订单退款事件回调

- 订单详情

    包含订单与订单商品所有信息

    包含预计等待时间,与前有多少杯咖啡的信息

- 订单列表

    支持条件查询: 用户,商品,订单状态,支付状态,下单时间等
    支持多条件与查询
    支持多条件或查询
    支持分页查询
    条件支持: 等于,模糊,包含,大于,小于

- 订单维度评价

    支持订单维度NPS打分评价（0-10分）

- 订单评价拉取

    支持分页拉取
    支持时间范围筛选
    支持商品sku范围筛选

##  商品

- 基础的商品配置

    价格,库存,名称,图片等常规字段

- 多规格商品的配置

    支持自定义多规格,与多规格价格
    如:杯型,温度,甜度

- 分页条件查询商品基础信息

    支持分页
    支持条件: 名称,编码等
    支持多条件与查询
    支持多条件或查询
    支持分页查询
    条件支持: 等于,模糊,包含,大于,小于

- C端商品列表(支持动态价格计算)

    获取C端商品列表
    已上架,可点单的商品.(包括所有规格信息)
    必须字段:
    动态价格:根据适用营销活动(优惠规则)与用户优惠券计算出来的商品单价
    划线价格:(原价)
    等常规字段:库存,商品名称,描述等

## 事件回调

- 订单状态变更回调

    创建订单
    取消订单
    ..其他订单状态变更通知

- 可取餐状态通知回调

    订单商品可取餐

- 订单支付状态变更回调
  
    支付成功
    申请退款
    退款成功

- 用户优惠券事件回调

    用户获取优惠券
    用户优惠券核销
    用户优惠券过期
    用户优惠券被撤回